<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>radicle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" media="screen" href="css/style.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="css/codemirror-repl.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="css/repl-theme.css" />
  <script src="js/codemirror-repl.js"></script>
  <script src="js/rad.js"></script>
</head>

<body>
  <div class="content">
    <header>
      <pre>
██████╗  █████╗ ██████╗ ██╗ ██████╗██╗     ███████╗
██╔══██╗██╔══██╗██╔══██╗██║██╔════╝██║     ██╔════╝
██████╔╝███████║██║  ██║██║██║     ██║     █████╗
██╔══██╗██╔══██║██║  ██║██║██║     ██║     ██╔══╝
██║  ██║██║  ██║██████╔╝██║╚██████╗███████╗███████╗
╚═╝  ╚═╝╚═╝  ╚═╝╚═════╝ ╚═╝ ╚═════╝╚══════╝╚══════╝
      </pre>
      <h3>A language for peer-to-peer collaboration</h3>
    </header>
    <div class="repl">
      <textarea id="repl" autofocus="true"></textarea>
    </div>
    <footer>
      <div class="about">
        <h4>Why radicle</h4>
        <p>
          radicle is a language that makes collaboration a primitive. Different environments ("chains") can be given their own semantics,
          including who can modify them, and can be accessed as easily as your local environment.
          </br>
          </br>
          radicle was developed to be the basis of <a href="http://oscoin.io">open source coin</a>.
        </p>
      </div>
      <div class="contact">
        <h4>Get in touch</h4>
        <p>
          If you’re interested in radicle or want to contribute, you can find us here:
        </p>
        <div class="social">
          <a href="radicle@monadic.xyz">radicle@monadic.xyz</a>
          <p>#radicle on freenode</p>
        </div>
      </div>
    </footer>

  </div>
  <div class="docs">
    <div class="docs-wrapper">
      <h4>Example of radicle code</h4>
      <p>This example shows you how one would program an issues chain. In this
      example, we require that chains have an author, title, description, and failing test case. </p>
      <pre>
    "first lines cannot be comments"

    ;; Issues for rad prelude

    (define create-rad-issue-chain (lambda ()
      (define issues (ref nil))
      (define should-be (lambda (name x y) (eq? x y)))
      (define current-prelude (ref (dict :env (dict 'should-be should-be 'eval eval) :refs nil)))


      (define failing? (lambda (expr)
        (define res (catch 'any
                            (head (eval-with-env expr (read-ref current-prelude)))
                            (lambda (x) #f)))
        (eq? res #f)))

      (define new-issue (lambda (creator title desc failing-test)
        (if (failing? failing-test)
            (modify-ref
              issues
              (lambda (x)
                (cons (dict
                  :creator creator
                  :title title
                  :description desc
                  :failing-test failing-test) x)))
            "Test is not failing")))

      (define list-issues (lambda () (read-ref issues)))

      (define dispatch (lambda (m)
        (if (eq? m 'new-issue) new-issue
        (if (eq? m 'list-issues) list-issues
            "error: unknown message"))))

      dispatch))

    (define rad-issue-chain (create-rad-issue-chain))

    (define rad-issue-chain-eval (lambda (expr)
          (if (eq? (head expr) 'new-issue)
              (apply (rad-issue-chain 'new-issue) (tail expr))
          (if (eq? (head expr) 'list-issues)
              ((rad-issue-chain 'list-issues))
              "must be one of: 'new-issue', 'list-issues'"))
          ))
    </pre>
      <p>For more examples, check <a href="http://git.oscoin.io/radicle/tree/rad?h=origin/demo" target="_blank">here</a></p>
    </div>
  </div>
</body>
<script language="javascript" src="js/all.min.js"></script>

<script language="javascript">
  // Setup the repl.
  var repl = new CodeMirrorREPL("repl", {
    mode: "rad",
    theme: "base16-dark",
  });

  function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

  async function eval_fn(expr) {
    var tmp = { "arg": expr };
    if (typeof eval_fn_ === "undefined") {
      await sleep(2000);
    };
    try {
      eval_fn_(tmp);
      if (typeof tmp.result === "undefined") {
        console.log("sleeping in the hope this is an async call");
        await sleep(2000);
      }
      repl.print(tmp.result);
    } catch (error) {
      console.log(error);
      repl.print(error, "error");
    }
  }
  repl.eval = eval_fn;
  repl.print("radicle (pre-alpha).");
  repl.print("Type '(help)' for help.");
  repl.print("");
  repl.print("");

</script>

</html>
